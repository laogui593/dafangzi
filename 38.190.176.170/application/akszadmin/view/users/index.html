{extend name='main'}

{block name="button"}

{if auth("add")}
<button data-modal='{:url(ADMIN_MODULE."/users/add")}' data-title="æ·»åŠ ç”¨æˆ·" class='layui-btn layui-btn-sm layui-btn-primary'>æ·»åŠ ç”¨æˆ·</button>
{/if}

{if auth("forbid")}
<button data-action='{:url(ADMIN_MODULE."/users/forbid")}' data-rule="id#{key}" data-csrf="{:systoken('forbid')}" data-confirm="ç¡®å®šè¦å†»ç»“è¿™äº›ç”¨æˆ·å—ï¼Ÿ" class='layui-btn layui-btn-sm layui-btn-primary'>å†»ç»“ç”¨æˆ·</button>
{/if}

{if auth("remove")}
<button data-action='{:url(ADMIN_MODULE."/users/remove")}' data-rule="id#{key}" data-csrf="{:systoken('remove')}" data-confirm="ç¡®å®šè¦åˆ é™¤è¿™äº›ç”¨æˆ·å—ï¼Ÿ" class='layui-btn layui-btn-sm layui-btn-primary'>åˆ é™¤ç”¨æˆ·</button>
{/if}

{/block}

{block name="content"}
<div class="think-box-shadow">
    {include file='users/index_search'}
    <table class="layui-table margin-top-10" lay-skin="line">
        {notempty name='list'}
        <thead>
        <tr>
            <th class='list-table-check-td think-checkbox'>
                <label><input data-auto-none data-check-target='.list-check-box' type='checkbox'></label>
            </th>
            <th class='text-left nowrap'>ç”¨æˆ·ä¿¡æ¯</th>
            <th class='text-left nowrap'>ç”¨æˆ·èµ„æ–™</th>
            <th class='text-left nowrap'>ç”¨æˆ·èµ„é‡‘ï¼ˆç‚¹å‡»é‡‘é¢æŸ¥çœ‹ï¼‰</th>
            <th class='text-left nowrap'>ç”¨æˆ·è¯¦æƒ…</th>
            <th class='text-left nowrap'>æ—¶é—´</th>
            <th class='text-left nowrap'></th>
        </tr>
        </thead>
        {/notempty}
        <tbody>
        {foreach $list as $key=>$vo}
        <tr data-dbclick class="{$vo.robot==1?'robot-row':''}">
            <td class='list-table-check-td think-checkbox'>
                <label><input class="list-check-box" value='{$vo.id}' type='checkbox'></label>
            </td>
            <td class='text-left nowrap'>
                IDï¼š{$vo.id|default='--'}<br>
                å§“åï¼š{$vo.name|default='--'}<br>
                ç”¨æˆ·åï¼š<a data-title="æŸ¥çœ‹æµæ°´" data-open='{:url(ADMIN_MODULE."/finance/index")}?u_phone={$vo.phone}'>{$vo.phone|default='--'}</a><br>
                æ‰‹æœºï¼š{$vo.phones|default='--'}<br>
                çŠ¶æ€ï¼š
                {eq name='vo.online' value='false'}
                <span class="color-desc">ç¦»çº¿</span>
                {else}
                <span class="color-green">åœ¨çº¿</span>
                {/eq}
                <br>
                å®åï¼š
                {eq name='vo.rz_status' value='0'}
                <span class="color-red">{$vo.robot==1?'å‡äºº':'æœªå®å'}</span>
                {elseif $vo.rz_status == 1}
                <span class="color-green">{$vo.robot==1?'å‡äºº':'å¾…å®¡æ ¸'}</span>
                {elseif $vo.rz_status == 2}
                <span class="color-green">{$vo.robot==1?'å‡äºº':'å·²å®å'}</span>
                {elseif $vo.rz_status == 3}
                <span class="color-green">{$vo.robot==1?'å‡äºº':'å·²é©³å›'}</span>
                {/eq}<br>
                
            </td>
            <td class='text-left nowrap'>
                ä¼šå‘˜ç­‰çº§ï¼š{$vo.m_name|default='--'}<br>
                æ¨èäººï¼š{$vo.top|default='--'}<br>
                IPï¼š{$vo.ip|default='--'}<br>
                ISPï¼š{$vo.isp|default='--'}<br>
                æ³¨å†Œæ¥æºï¼š{$vo.zcly|default='--'}<br>
            </td>
            <td class='text-left nowrap'>
                è´¦æˆ·ä½™é¢ï¼š<a data-title="æŸ¥çœ‹å……å€¼è®°å½•" class="color-red" data-open='{:url(ADMIN_MODULE."/recharge/index")}?u_phone={$vo.phone}'>{$vo.money|default='--'} å…ƒ</a><br>
                æç°æ€»é¢ï¼š<a data-title="æŸ¥çœ‹æç°" class="color-green" data-open='{:url(ADMIN_MODULE."/cash/index")}?u_phone={$vo.phone}&i_status=1'>{$vo.cash_sum|default='--'} å…ƒ</a><br>
                å……å€¼æ€»é¢ï¼š<a data-title="æŸ¥çœ‹å……å€¼è®°å½•" style="color: orange" data-open='{:url(ADMIN_MODULE."/recharge/index")}?u_phone={$vo.phone}&i_status=1'>{$vo.recharge_sum|default='--'} å…ƒ</a><br>
                æŠ•èµ„æ€»é¢ï¼š<a data-title="æŸ¥çœ‹æŠ•èµ„" data-open='{:url(ADMIN_MODULE."/invest/index")}?u_phone={$vo.phone}'>{$vo.invest_sum|default='--'} å…ƒ</a><br>
                ä¿¡ç”¨åˆ†ï¼š<a data-title="ä¿¡ç”¨åˆ†" >{$vo.xinyongfen|default='--'} ä¿¡ç”¨åˆ†</a><br>
            </td>
            <td class='text-left nowrap'>
                å¾…æ”¶åˆ©æ¯ï¼š{$vo.wait_invest|default='--'} å…ƒ<br>
                å¾…æ”¶æœ¬é‡‘ï¼š{$vo.wait_money|default='--'} å…ƒ<br>
                æˆé•¿å€¼ï¼š{$vo.value|default='--'}<br>
            </td>
            <td class='text-left nowrap'>
                ç”¨æˆ·çŠ¶æ€ï¼š
                {eq name='vo.clock' value='0'}
                <span class="color-red">å·²å†»ç»“</span>
                {else}
                <span class="color-green">æ­£å¸¸</span>
                {/eq}<br>
                æ³¨å†Œæ—¶é—´ï¼š{$vo.time}<br>
                æœ€è¿‘æ“ä½œï¼š{$vo.logintime|format_datetime}<br>
				ç™»é™†IPï¼š{$vo.loginip|default='--'}<br>
                ISPï¼š{$vo.isp2|default='--'}<br>
            </td>
            <td class='text-left nowrap'>
				{if $vo.isjy == 1}
                    <a class="layui-btn layui-btn-sm layui-btn-danger" data-confirm="ç¡®å®šè¦å¼€å¯äº¤æ˜“åŠŸèƒ½å—?" data-action="{:url(ADMIN_MODULE.'/users/iskqopen')}" data-value="id#{$vo.id};iskq#0" data-csrf="{:systoken('iskqopen')}">äº¤æ˜“å…³é—­</a>
                    {else /}
                    <a class="layui-btn layui-btn-sm layui-btn-success" data-confirm="ç¡®å®šè¦å…³é—­äº¤æ˜“åŠŸèƒ½å—?" data-action="{:url(ADMIN_MODULE.'/users/iskqopen')}" data-value="id#{$vo.id};iskq#1" data-csrf="{:systoken('iskqopen')}">äº¤æ˜“å¼€å¯</a>
                    {/if}
                {if auth("review")}
                <a data-dbclick class="layui-btn layui-btn-sm" data-title="å®åè®¤è¯å®¡æ ¸" data-modal='{:url(ADMIN_MODULE."/users/review")}?id={$vo.id}'>å®åè®¤è¯å®¡æ ¸</a>
                {/if}
                {if auth("edit")}
                <a data-dbclick class="layui-btn layui-btn-sm" data-title="ç¼–è¾‘ç”¨æˆ·" data-modal='{:url(ADMIN_MODULE."/users/edit")}?id={$vo.id}'>ç¼– è¾‘</a>
                {/if}
                <a class="layui-btn layui-btn-sm layui-btn-normal" onclick="openRecharge('{$vo.id}', '{$vo.phone}')" style="cursor:pointer;">ğŸ’° å……å€¼</a>
                {if $vo.clock eq 1 and auth("forbid")}
                <a class="layui-btn layui-btn-sm layui-btn-warm" data-action="{:url(ADMIN_MODULE.'/users/forbid')}" data-value="id#{$vo.id};clock#0" data-csrf="{:systoken('forbid')}">å†» ç»“</a>
                {elseif $vo.clock eq 0 and auth("resume")}
                <a class="layui-btn layui-btn-sm layui-btn-warm" data-action="{:url(ADMIN_MODULE.'/users/resume')}" data-value="id#{$vo.id};clock#1" data-csrf="{:systoken('resume')}">è§£ å†»</a>
                {/if}
                <br><a style="margin-top:5px" class="layui-btn layui-btn-sm layui-btn-danger" data-action="{:url(ADMIN_MODULE.'/users/setrobot')}" data-value="id#{$vo.id};clock#{$vo.robot==1?0:1}" data-csrf="{:systoken('setrobot')}">{$vo.robot==1?"è®¾ç½®æˆçœŸäºº":"è®¾ç½®æˆå‡äºº"}</a>
            </td>
        </tr>
        {/foreach}
        </tbody>
    </table>
    {empty name='list'}<span class="notdata">æ²¡æœ‰è®°å½•å“¦</span>{else}{$pagehtml|raw|default=''}{/empty}
</div>

<script>
// å……å€¼å¼¹çª—
function openRecharge(uid, phone) {
    layer.prompt({
        title: 'ä¸ºç”¨æˆ· ' + phone + ' å……å€¼',
        formType: 0,
        value: '',
        btn: ['ç¡®è®¤å……å€¼', 'å–æ¶ˆ']
    }, function(value, index, elem){
        if (!value || parseFloat(value) <= 0) {
            layer.msg('è¯·è¾“å…¥æœ‰æ•ˆçš„å……å€¼é‡‘é¢', {icon: 2});
            return false;
        }
        
        // å‘é€å……å€¼è¯·æ±‚
        $.post('{:url(ADMIN_MODULE."/users/quickRecharge")}', {
            uid: uid,
            money: value
        }, function(res) {
            if (res.code === 1) {
                layer.msg(res.info, {icon: 1});
                layer.close(index);
                setTimeout(function(){
                    location.reload();
                }, 1000);
            } else {
                layer.msg(res.info || 'å……å€¼å¤±è´¥', {icon: 2});
            }
        }, 'json').fail(function() {
            layer.msg('å……å€¼è¯·æ±‚å¤±è´¥', {icon: 2});
        });
    });
}
</script>

<style>
.robot-row {
    background-color: #b3b3b3 !important;
}
</style>

{/block}
